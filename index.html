<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IP Change Checker</title>

<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
  #box {
    display: inline-block;
    width: 30px;
    height: 30px;
    margin-left: 12px;
    border: 2px solid #ccc;
    background: #eee;
    vertical-align: middle;
  }
  #countdown {
    margin-left: 10px;
    font-size: 14px;
    color: #555;
    display: inline-block;
    min-width: 60px;
  }
</style>
</head>
<body>

<button id="changeBtn">Change IP</button>
<div id="box"></div>
<div id="countdown"></div>

<script>
const CHANGE_IP_URL = 'https://i.fxdx.in/actionlinks/do/changeip/YTbojipTQnuowNvn2MkNoA';
const IP_API = 'https://api.ipify.org?format=json';

const btn = document.getElementById('changeBtn');
const box = document.getElementById('box');
const countdownEl = document.getElementById('countdown');

let oldIP = null;
let countdownTimer = null;

async function getIP() {
  try {
    const res = await fetch(IP_API, { cache: 'no-store' });
    const data = await res.json();
    return data.ip;
  } catch {
    return null; // force retry
  }
}

function startCountdown(seconds, callback) {
  clearInterval(countdownTimer);
  countdownEl.textContent = seconds + 's';

  countdownTimer = setInterval(() => {
    seconds--;
    countdownEl.textContent = seconds + 's';

    if (seconds <= 0) {
      clearInterval(countdownTimer);
      countdownEl.textContent = '';
      callback();
    }
  }, 1000);
}

async function checkIPLoop() {
  box.style.background = 'yellow';

  const newIP = await getIP();

  if (newIP && newIP !== oldIP) {
    box.style.background = 'green';
    btn.disabled = false;
  } else {
    box.style.background = 'red';
    startCountdown(10, checkIPLoop); // ðŸ” ALWAYS retry
  }
}

btn.addEventListener('click', async () => {
  btn.disabled = true;
  box.style.background = '#eee';
  countdownEl.textContent = '';

  oldIP = await getIP();

  fetch(CHANGE_IP_URL).catch(() => {});

  startCountdown(25, checkIPLoop);
});
</script>

</body>
</html>
